nt$t23s <- nm; lb <- which((nt$t1==0)&(nt$t2!=0)&(nt$t3!=0))
nt$t23s[lb] <- (abs(rmat[[2]][lb])+abs(rmat[[3]][lb]))/2
nt$t123s <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0)&(nt$t3!=0))
nt$t123s[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb])+abs(rmat[[3]][lb]))/3
return(nt)
}
get_sp_net_2t <- function(rmat){
nm <- matrix(0,dim(rmat[[1]])[1],dim(rmat[[1]])[1])
nt <- list()
nt$t1 <- rmat[[1]]
nt$t2 <- rmat[[2]]
nt$t1s <- nm;lb <- which((nt$t1!=0)&(nt$t2==0))
nt$t1s[lb] <- rmat[[1]][lb]
nt$t2s <- nm;lb <- which((nt$t1==0)&(nt$t2!=0))
nt$t2s[lb] <- rmat[[2]][lb]
nt$t12 <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0))
nt$t12[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb]))/2
return(nt)
}
show_net <- function(mat,gname=c(1:dim(mat)[1])){
nt <- mat
colnames(nt) <- gname
lb <- rowSums(nt|nt)!=0
nt <- nt[which(lb),which(lb)]
ntp <- graph_from_adjacency_matrix(nt,weighted = T)
V(ntp)$color = "firebrick1"
V(ntp)$size = 4
V(ntp)$label=V(ntp)$name
V(ntp)$label.cex=0.7
V(ntp)$label.color="black"
E(ntp)$arrow.size =0
E(ntp)$color = "gray60"
E(ntp)$width=1.5
plot(ntp,layout=layout.fruchterman.reingold)
}
get_top_node <- function(mat,topn,gname){
temp <- rowSums(abs(mat)>0)
names(temp) <- gname
return(sort(temp,decreasing = T)[1:topn])
}
################################################
### get the theta
x <- expr                       # get the preloaded data
gname <- colnames(expr[[1]])    # get name of genes
str(x)                          # check the data
dim(x$brain)
dim(x$heart)
temp <- get_scr_mat(expr1 = x[[1]],expr2 = x[[2]])
scr.mat <- temp$scr.mat
sum(scr.mat)/(prod(dim(scr.mat)))
s.sl <- temp$s
lam1=0.0004
lam2=0.0004
temp = CFGL(expr, lambda1 = lam1, lambda2 = lam2, btc.screening = scr.mat)
theta <- temp$theta
lattice::levelplot(theta[[1]]!=0)
##############################################
### get r mat
rmat <- theta2rmat(theta)
### show newtwork
nt <- rmat[[1]]
gname <- colnames(expr[[1]])
colnames(nt) <- gname
lb <- rowSums(nt|nt)!=0
nt <- nt[which(lb),which(lb)]
ntp <- graph_from_adjacency_matrix(nt,weighted = T)
V(ntp)$color = "firebrick1"
V(ntp)$size = 4
V(ntp)$label=V(ntp)$name
V(ntp)$label.cex=0.7
V(ntp)$label.color="black"
E(ntp)$arrow.size =0
E(ntp)$color = "gray60"
E(ntp)$width=1.5
plot(ntp,layout=layout.fruchterman.reingold)
g <- sample_pa(20, m=2)
minC <- rep(-Inf, vcount(g))
maxC <- rep(Inf, vcount(g))
minC[1] <- maxC[1] <- 0
co <- layout_with_fr(g, minx=minC, maxx=maxC,
miny=minC, maxy=maxC)
co[1,]
plot(g, layout=co, vertex.size=30, edge.arrow.size=0.2,
vertex.label=c("ego", rep("", vcount(g)-1)), rescale=FALSE,
xlim=range(co[,1]), ylim=range(co[,2]), vertex.label.dist=0,
vertex.label.color="red")
axis(1)
axis(2)
plot(ntp,layout=layout_with_fr(ntp))
plot(ntp,layout=layout_with_fr(ntp))
g <- sample_pa(20, m=2)
minC <- rep(-Inf, vcount(g))
maxC <- rep(Inf, vcount(g))
minC[1] <- maxC[1] <- 0
co <- layout_with_fr(g, minx=minC, maxx=maxC,
miny=minC, maxy=maxC)
co[1,]
plot(g, layout=co, vertex.size=30, edge.arrow.size=0.2,
vertex.label=c("ego", rep("", vcount(g)-1)), rescale=FALSE,
xlim=range(co[,1]), ylim=range(co[,2]), vertex.label.dist=0,
vertex.label.color="red")
axis(1)
axis(2)
setwd("d:/R_work/CFGL/");
rm(list=ls(all=TRUE));
library("devtools")
library("roxygen2")
library("igraph")
#install_github("Yafei611/CFGL",build_vignettes = T)
library(CFGL)
################################################
theta2rmat <- function(theta,top_edge=NULL,min_edge=0,keep.diag=F,verbose=F){
temp0 <- NULL
temp1 <- NULL
temp2 <- NULL
rmat <- list()
rmat2 <- list()
for (i in 1:length(theta)) {
temp <- diag(theta[[i]])
rmat[[i]] <- -theta[[i]]/sqrt(temp%*%t(temp))
}
if (!is.null(top_edge)){
for (i in 1:length(rmat)) {
temp0 <- rmat[[i]]
diag(temp0) <- 0
temp1 <- c(temp1,abs(as.vector(temp0)))
}
temp1 <- temp1[which(temp1!=0)]
min_edge0 <- temp1[which(rank(-temp1,ties.method = "random")==top_edge)]
if (min_edge0>min_edge) print("Min_edge was overrided")
min_edge <- max(min_edge0,min_edge)
}
if (verbose) print(paste("min_edge is",min_edge))
for (i in 1:length(rmat)) {
temp2 <- rmat[[i]]
diag(temp2) <- 0
temp2[abs(temp2)<min_edge] <- 0
rmat2[[i]] <- temp2
if (keep.diag) diag(rmat2[[i]]) <- diag(rmat[[i]])
}
return(rmat2)
}
get_sp_net_3t <- function(rmat){
nm <- matrix(0,dim(rmat[[1]])[1],dim(rmat[[1]])[1])
nt <- list()
nt$t1 <- rmat[[1]]
nt$t2 <- rmat[[2]]
nt$t3 <- rmat[[3]]
nt$t1s <- nm;lb <- which((nt$t1!=0)&(nt$t2==0)&(nt$t3==0))
nt$t1s[lb] <- rmat[[1]][lb]
nt$t2s <- nm;lb <- which((nt$t1==0)&(nt$t2!=0)&(nt$t3==0))
nt$t2s[lb] <- rmat[[2]][lb]
nt$t3s <- nm;lb <- which((nt$t1==0)&(nt$t2==0)&(nt$t3!=0))
nt$t3s[lb] <- rmat[[3]][lb]
nt$t12s <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0)&(nt$t3==0))
nt$t12s[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb]))/2
nt$t13s <- nm; lb <- which((nt$t1!=0)&(nt$t2==0)&(nt$t3!=0))
nt$t13s[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[3]][lb]))/2
nt$t23s <- nm; lb <- which((nt$t1==0)&(nt$t2!=0)&(nt$t3!=0))
nt$t23s[lb] <- (abs(rmat[[2]][lb])+abs(rmat[[3]][lb]))/2
nt$t123s <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0)&(nt$t3!=0))
nt$t123s[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb])+abs(rmat[[3]][lb]))/3
return(nt)
}
get_sp_net_2t <- function(rmat){
nm <- matrix(0,dim(rmat[[1]])[1],dim(rmat[[1]])[1])
nt <- list()
nt$t1 <- rmat[[1]]
nt$t2 <- rmat[[2]]
nt$t1s <- nm;lb <- which((nt$t1!=0)&(nt$t2==0))
nt$t1s[lb] <- rmat[[1]][lb]
nt$t2s <- nm;lb <- which((nt$t1==0)&(nt$t2!=0))
nt$t2s[lb] <- rmat[[2]][lb]
nt$t12 <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0))
nt$t12[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb]))/2
return(nt)
}
show_net <- function(mat,gname=c(1:dim(mat)[1])){
nt <- mat
colnames(nt) <- gname
lb <- rowSums(nt|nt)!=0
nt <- nt[which(lb),which(lb)]
ntp <- graph_from_adjacency_matrix(nt,weighted = T)
V(ntp)$color = "firebrick1"
V(ntp)$size = 4
V(ntp)$label=V(ntp)$name
V(ntp)$label.cex=0.7
V(ntp)$label.color="black"
E(ntp)$arrow.size =0
E(ntp)$color = "gray60"
E(ntp)$width=1.5
plot(ntp,layout=layout.fruchterman.reingold)
}
get_top_node <- function(mat,topn,gname){
temp <- rowSums(abs(mat)>0)
names(temp) <- gname
return(sort(temp,decreasing = T)[1:topn])
}
################################################
### get the theta
x <- expr                       # get the preloaded data
gname <- colnames(expr[[1]])    # get name of genes
str(x)                          # check the data
dim(x$brain)
dim(x$heart)
temp <- get_scr_mat(expr1 = x[[1]],expr2 = x[[2]])
scr.mat <- temp$scr.mat
sum(scr.mat)/(prod(dim(scr.mat)))
s.sl <- temp$s
lam1=0.001
lam2=0.001
temp = CFGL(expr, lambda1 = lam1, lambda2 = lam2, btc.screening = scr.mat)
theta <- temp$theta
lattice::levelplot(theta[[1]]!=0)
##############################################
### get r mat
rmat <- theta2rmat(theta)
### show newtwork
nt <- rmat[[1]]
gname <- colnames(expr[[1]])
colnames(nt) <- gname
lb <- rowSums(nt|nt)!=0
nt <- nt[which(lb),which(lb)]
ntp <- graph_from_adjacency_matrix(nt,weighted = T)
V(ntp)$color = "firebrick1"
V(ntp)$size = 4
V(ntp)$label=V(ntp)$name
V(ntp)$label.cex=0.7
V(ntp)$label.color="black"
E(ntp)$arrow.size =0
E(ntp)$color = "gray60"
E(ntp)$width=1.5
plot(ntp,layout=layout.fruchterman.reingold.grid)
plot(ntp,layout=layout.fruchterman.reingold)
setwd("d:/R_work/CFGL/");
rm(list=ls(all=TRUE));
library("devtools")
library("roxygen2")
library("igraph")
#install_github("Yafei611/CFGL",build_vignettes = T)
library(CFGL)
################################################
theta2rmat <- function(theta,top_edge=NULL,min_edge=0,keep.diag=F,verbose=F){
temp0 <- NULL
temp1 <- NULL
temp2 <- NULL
rmat <- list()
rmat2 <- list()
for (i in 1:length(theta)) {
temp <- diag(theta[[i]])
rmat[[i]] <- -theta[[i]]/sqrt(temp%*%t(temp))
}
if (!is.null(top_edge)){
for (i in 1:length(rmat)) {
temp0 <- rmat[[i]]
diag(temp0) <- 0
temp1 <- c(temp1,abs(as.vector(temp0)))
}
temp1 <- temp1[which(temp1!=0)]
min_edge0 <- temp1[which(rank(-temp1,ties.method = "random")==top_edge)]
if (min_edge0>min_edge) print("Min_edge was overrided")
min_edge <- max(min_edge0,min_edge)
}
if (verbose) print(paste("min_edge is",min_edge))
for (i in 1:length(rmat)) {
temp2 <- rmat[[i]]
diag(temp2) <- 0
temp2[abs(temp2)<min_edge] <- 0
rmat2[[i]] <- temp2
if (keep.diag) diag(rmat2[[i]]) <- diag(rmat[[i]])
}
return(rmat2)
}
get_sp_net_3t <- function(rmat){
nm <- matrix(0,dim(rmat[[1]])[1],dim(rmat[[1]])[1])
nt <- list()
nt$t1 <- rmat[[1]]
nt$t2 <- rmat[[2]]
nt$t3 <- rmat[[3]]
nt$t1s <- nm;lb <- which((nt$t1!=0)&(nt$t2==0)&(nt$t3==0))
nt$t1s[lb] <- rmat[[1]][lb]
nt$t2s <- nm;lb <- which((nt$t1==0)&(nt$t2!=0)&(nt$t3==0))
nt$t2s[lb] <- rmat[[2]][lb]
nt$t3s <- nm;lb <- which((nt$t1==0)&(nt$t2==0)&(nt$t3!=0))
nt$t3s[lb] <- rmat[[3]][lb]
nt$t12s <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0)&(nt$t3==0))
nt$t12s[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb]))/2
nt$t13s <- nm; lb <- which((nt$t1!=0)&(nt$t2==0)&(nt$t3!=0))
nt$t13s[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[3]][lb]))/2
nt$t23s <- nm; lb <- which((nt$t1==0)&(nt$t2!=0)&(nt$t3!=0))
nt$t23s[lb] <- (abs(rmat[[2]][lb])+abs(rmat[[3]][lb]))/2
nt$t123s <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0)&(nt$t3!=0))
nt$t123s[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb])+abs(rmat[[3]][lb]))/3
return(nt)
}
get_sp_net_2t <- function(rmat){
nm <- matrix(0,dim(rmat[[1]])[1],dim(rmat[[1]])[1])
nt <- list()
nt$t1 <- rmat[[1]]
nt$t2 <- rmat[[2]]
nt$t1s <- nm;lb <- which((nt$t1!=0)&(nt$t2==0))
nt$t1s[lb] <- rmat[[1]][lb]
nt$t2s <- nm;lb <- which((nt$t1==0)&(nt$t2!=0))
nt$t2s[lb] <- rmat[[2]][lb]
nt$t12 <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0))
nt$t12[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb]))/2
return(nt)
}
show_net <- function(mat,gname=c(1:dim(mat)[1])){
nt <- mat
colnames(nt) <- gname
lb <- rowSums(nt|nt)!=0
nt <- nt[which(lb),which(lb)]
ntp <- graph_from_adjacency_matrix(nt,weighted = T)
V(ntp)$color = "firebrick1"
V(ntp)$size = 4
V(ntp)$label=V(ntp)$name
V(ntp)$label.cex=0.7
V(ntp)$label.color="black"
E(ntp)$arrow.size =0
E(ntp)$color = "gray60"
E(ntp)$width=1.5
plot(ntp,layout=layout.fruchterman.reingold)
}
get_top_node <- function(mat,topn,gname){
temp <- rowSums(abs(mat)>0)
names(temp) <- gname
return(sort(temp,decreasing = T)[1:topn])
}
################################################
### get the theta
x <- expr                       # get the preloaded data
gname <- colnames(expr[[1]])    # get name of genes
str(x)                          # check the data
dim(x$brain)
dim(x$heart)
temp <- get_scr_mat(expr1 = x[[1]],expr2 = x[[2]])
scr.mat <- temp$scr.mat
sum(scr.mat)/(prod(dim(scr.mat)))
s.sl <- temp$s
lam1=0.0007
lam2=0.0007
temp = CFGL(expr, lambda1 = lam1, lambda2 = lam2, btc.screening = scr.mat)
theta <- temp$theta
lattice::levelplot(theta[[1]]!=0)
##############################################
### get r mat
rmat <- theta2rmat(theta)
### show newtwork
nt <- rmat[[1]]
gname <- colnames(expr[[1]])
colnames(nt) <- gname
lb <- rowSums(nt|nt)!=0
nt <- nt[which(lb),which(lb)]
ntp <- graph_from_adjacency_matrix(nt,weighted = T)
V(ntp)$color = "firebrick1"
V(ntp)$size = 4
V(ntp)$label=V(ntp)$name
V(ntp)$label.cex=0.7
V(ntp)$label.color="black"
E(ntp)$arrow.size =0
E(ntp)$color = "gray60"
E(ntp)$width=1.5
plot(ntp,layout=layout.fruchterman.reingold)
###
plot(ntp)
setwd("d:/R_work/CFGL/");
rm(list=ls(all=TRUE));
library("devtools")
library("roxygen2")
library("igraph")
#install_github("Yafei611/CFGL",build_vignettes = T)
library(CFGL)
################################################
theta2rmat <- function(theta,top_edge=NULL,min_edge=0,keep.diag=F,verbose=F){
temp0 <- NULL
temp1 <- NULL
temp2 <- NULL
rmat <- list()
rmat2 <- list()
for (i in 1:length(theta)) {
temp <- diag(theta[[i]])
rmat[[i]] <- -theta[[i]]/sqrt(temp%*%t(temp))
}
if (!is.null(top_edge)){
for (i in 1:length(rmat)) {
temp0 <- rmat[[i]]
diag(temp0) <- 0
temp1 <- c(temp1,abs(as.vector(temp0)))
}
temp1 <- temp1[which(temp1!=0)]
min_edge0 <- temp1[which(rank(-temp1,ties.method = "random")==top_edge)]
if (min_edge0>min_edge) print("Min_edge was overrided")
min_edge <- max(min_edge0,min_edge)
}
if (verbose) print(paste("min_edge is",min_edge))
for (i in 1:length(rmat)) {
temp2 <- rmat[[i]]
diag(temp2) <- 0
temp2[abs(temp2)<min_edge] <- 0
rmat2[[i]] <- temp2
if (keep.diag) diag(rmat2[[i]]) <- diag(rmat[[i]])
}
return(rmat2)
}
get_sp_net_3t <- function(rmat){
nm <- matrix(0,dim(rmat[[1]])[1],dim(rmat[[1]])[1])
nt <- list()
nt$t1 <- rmat[[1]]
nt$t2 <- rmat[[2]]
nt$t3 <- rmat[[3]]
nt$t1s <- nm;lb <- which((nt$t1!=0)&(nt$t2==0)&(nt$t3==0))
nt$t1s[lb] <- rmat[[1]][lb]
nt$t2s <- nm;lb <- which((nt$t1==0)&(nt$t2!=0)&(nt$t3==0))
nt$t2s[lb] <- rmat[[2]][lb]
nt$t3s <- nm;lb <- which((nt$t1==0)&(nt$t2==0)&(nt$t3!=0))
nt$t3s[lb] <- rmat[[3]][lb]
nt$t12s <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0)&(nt$t3==0))
nt$t12s[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb]))/2
nt$t13s <- nm; lb <- which((nt$t1!=0)&(nt$t2==0)&(nt$t3!=0))
nt$t13s[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[3]][lb]))/2
nt$t23s <- nm; lb <- which((nt$t1==0)&(nt$t2!=0)&(nt$t3!=0))
nt$t23s[lb] <- (abs(rmat[[2]][lb])+abs(rmat[[3]][lb]))/2
nt$t123s <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0)&(nt$t3!=0))
nt$t123s[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb])+abs(rmat[[3]][lb]))/3
return(nt)
}
get_sp_net_2t <- function(rmat){
nm <- matrix(0,dim(rmat[[1]])[1],dim(rmat[[1]])[1])
nt <- list()
nt$t1 <- rmat[[1]]
nt$t2 <- rmat[[2]]
nt$t1s <- nm;lb <- which((nt$t1!=0)&(nt$t2==0))
nt$t1s[lb] <- rmat[[1]][lb]
nt$t2s <- nm;lb <- which((nt$t1==0)&(nt$t2!=0))
nt$t2s[lb] <- rmat[[2]][lb]
nt$t12 <- nm; lb <- which((nt$t1!=0)&(nt$t2!=0))
nt$t12[lb] <- (abs(rmat[[1]][lb])+abs(rmat[[2]][lb]))/2
return(nt)
}
show_net <- function(mat,gname=c(1:dim(mat)[1])){
nt <- mat
colnames(nt) <- gname
lb <- rowSums(nt|nt)!=0
nt <- nt[which(lb),which(lb)]
ntp <- graph_from_adjacency_matrix(nt,weighted = T)
V(ntp)$color = "firebrick1"
V(ntp)$size = 4
V(ntp)$label=V(ntp)$name
V(ntp)$label.cex=0.7
V(ntp)$label.color="black"
E(ntp)$arrow.size =0
E(ntp)$color = "gray60"
E(ntp)$width=1.5
plot(ntp)
}
get_top_node <- function(mat,topn,gname){
temp <- rowSums(abs(mat)>0)
names(temp) <- gname
return(sort(temp,decreasing = T)[1:topn])
}
################################################
### get the theta
x <- expr                       # get the preloaded data
gname <- colnames(expr[[1]])    # get name of genes
str(x)                          # check the data
dim(x$brain)
dim(x$heart)
temp <- get_scr_mat(expr1 = x[[1]],expr2 = x[[2]])
scr.mat <- temp$scr.mat
sum(scr.mat)/(prod(dim(scr.mat)))
s.sl <- temp$s
lam1=0.0006
lam2=0.0004
temp = CFGL(expr, lambda1 = lam1, lambda2 = lam2, btc.screening = scr.mat)
theta <- temp$theta
lattice::levelplot(theta[[1]]!=0)
##############################################
### get r mat
rmat <- theta2rmat(theta)
### show newtwork
nt <- rmat[[1]]
gname <- colnames(expr[[1]])
colnames(nt) <- gname
lb <- rowSums(nt|nt)!=0
nt <- nt[which(lb),which(lb)]
ntp <- graph_from_adjacency_matrix(nt,weighted = T)
V(ntp)$color = "firebrick1"
V(ntp)$size = 4
V(ntp)$label=V(ntp)$name
V(ntp)$label.cex=0.7
V(ntp)$label.color="black"
E(ntp)$arrow.size =0
E(ntp)$color = "gray60"
E(ntp)$width=1.5
plot(ntp)
plot(ntp,layout=2)
plot(ntp,rescale=F, layout=l*1.0)
plot(ntp,layout=layout.norm(l, ymin=-1, ymax=1, xmin=-1, xmax=1))
l <- layout.fruchterman.reingold(net.bg)
l <- layout.fruchterman.reingold(ntp)
plot(ntp,layout=layout.norm(l, ymin=-1, ymax=1, xmin=-1, xmax=1))
plot(ntp,layout=layout.norm(l, ymin=1, ymax=1, xmin=-1, xmax=1))
plot(ntp,layout=layout.norm(l, ymin=-1, ymax=1, xmin=-1, xmax=1))
plot(ntp,layout=layout.graphopt)
install_github("Yafei611/CFGL",build_vignettes = T)
rmat.sp <- get_sp_net_2t(rmat)
str(rmat.sp)
names(rmat.sp)
get_sp_net_2t(
)
get_sp_net_2t
